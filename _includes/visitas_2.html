<!DOCTYPE html>
<html>
<head>
    <title>Gastos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
          --primary-color: #2196F3;
          --border-radius: 8px;
        }
      
        body {
          font-family: 'Segoe UI', Arial, sans-serif;
          background-color: #f5f5f5;
          margin: 0;
          padding: 20px;
        }
      
        #contact-form {
          max-width: 600px;
          margin: 0 auto;
          padding: 30px;
          background: white;
          border-radius: var(--border-radius);
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
      
        h2 {
          color: #333;
          border-bottom: 2px solid var(--primary-color);
          padding-bottom: 10px;
          margin-top: 30px;
        }
      
        h4 {
          color: #555;
          margin-bottom: 10px;
        }
      
        .form-control {
          width: 100%;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: var(--border-radius);
          margin-bottom: 15px;
          box-sizing: border-box;
        }
      
        input[type="number"] {
          height: 40px !important;
          width: 100% !important;
          margin-bottom: 20px;
        }
      
        input[type="radio"] {
          margin-right: 10px;
        }
      
        .radio-group {
          margin-bottom: 15px;
        }

        .action {
            background: #f5f5f5;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);    
            font-size: 14px;
            padding: 30px;
        }

        button[type="submit"] {
          background-color: var(--primary-color);
          color: white;
          padding: 12px 24px;
          border: none;
          border-radius: var(--border-radius);
          cursor: pointer;
          font-size: 16px;
          width: 100%;
          transition: background-color 0.3s ease;
        }
      
        button[type="submit"]:hover {
          background-color: #1976D2;
        }
      
        /* Radio button styling */
        input[type="radio"] + label {
          cursor: pointer;
          padding: 5px 10px;
        }

        /* new stuff for file upload */
        .file-upload {
            margin-bottom: 20px;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: inline-block;
            margin-bottom: 10px;
        }

        .file-upload label:hover {
            background-color: #1976D2;
        }

        #file-name-display {
            margin-top: 5px;
            color: #666;
        }


        #loading-overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
          }

          #loading-overlay > div {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: white;
              padding: 20px;
              border-radius: var(--border-radius);
              text-align: center;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          }

          #loading-overlay p {
              margin: 10px 0;
              color: #333;
          }

      </style>
      

</head>
<body>
      <form id="contact-form" onsubmit="return submitToAPI(event)">
        <h2>General</h2>
        <h3><label for="propiedad">Propiedad:</label></h3>
        <select name="propiedad" id="propiedad">
          <option value="usera">usera</option>
          <option value="hortaleza">hortaleza</option>
        </select>


        <h3>Caja</h3>
        <div class="instructions">
            <p>
                Quitar Alarma. Abrir atras. Hacer movimientos de caja:
            </p>
            <ol>
                <li>Revisar si tiene papel la impresora.
                    <div class="action">
                        <label for="changepaper">Cambiaste el papel?</label>
                        <input
                          type="checkbox"
                          id="changepaper"
                          name="changepaper"
                          value="false" 
                          unchecked />
                      </div>
                </li>
                <li>Entrar al sistema con tarjeta de administrador</li>
                <li>Descargar todo</li>
                <li>Imprimir comprobante</li>
                <li>Tomar foto al comprobante y subir a grupo de Whatsapp</li>
                <li>Contar los billetes, hacer movimiento en sistema
                    <div class="action">
                        <a href="https://mcfsoluciones.com/movimientos" target="_blank">mcfsoluciones/movimientos</a>
                    </div>
                </li>
                <li>Contar monedas, hacer movimiento en sistema (poner como usuario: "local") en este sistema:</li>
                <div class="action">
                  <a href="https://mcfsoluciones.com/movimientos" target="_blank">mcfsoluciones/movimientos</a>
                </div>
                <li>Guardar monedas en cajas de cada denominación</li>
                <li>Si se requiere, cargar monedas en punto de venta
                  <div class="action">
                    <label for="addhopper">Cargaste Monedas?</label>
                    <input
                      type="checkbox"
                      id="addhopper"
                      name="addhopper"
                      value="false" 
                      unchecked />
                  </div>
                </li>
                <li>Si agregaste monedas al punto de venta, subir movimiento en sistema (poner como usuario: "local") y movimiento: fondo de caja</li>
                <li>Cerrar caja con llave y asegurar que no se mueva por alarma</li>
            </ol>
        </div>

        <h3>Insumos</h3>
        <div class="instructions">
          <p>
              Ir hacia zona de insumos.
          </p>
          <ol>
              <li>Revisar niveles de suavizante, detergente y oxigeno. Deben estar en al menos 40% cada uno.</li>
              <li>Contar inventario <b>disponible</b> de cada insumo.
              <li>
                <div class="action">
                      <input type="number" 
                      id="detergente" 
                      label="detergente"
                      value="0"
                      step="0.05"
                      min="0"
                      placeholder="detergente" 
                      class="form-control" 
                  style="width:90%;"/>
                </div> 
                  <div class="action">
                    <input type="number" 
                    id="suavizante" 
                    label="suavizante"
                    value="0"
                    step="0.05"
                    min="0"
                    placeholder="suavizante" 
                    class="form-control" 
                    style="width:90%;"/>
                </div> 
                <div class="action">
                  <input type="number" 
                  id="oxigeno" 
                  label="oxigeno"
                  value="0"
                  step="0.05"
                  min="0"
                  placeholder="oxigeno" 
                  class="form-control" 
                  style="width:90%;"/>
              </div> 
            </li>
            <li>
              <div class="action">
                <label for="revniveles">Revisión de niveles de insumos</label>
                <input
                  type="checkbox"
                  id="revniveles"
                  name="revniveles"
                  value="false" 
                  unchecked />
              </div>
            </li>
            <li>
              <div class="action">
                <label for="tirar_botes">Tirar botes vacios</label>
                <input
                  type="checkbox"
                  id="tirar_botes"
                  name="tirar_botes"
                  value="false" 
                  unchecked />
              </div>
            </li>
          </ol>
      </div>

      <h3>Maquinas</h3>
      <div>
        <ol>
          <li>
            <div class="action">
              <label for="revbombas">Revisión de bombas de carga</label>
              <input
                type="checkbox"
                id="revbombas"
                name="revbombas"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_lav1">Re-inicio de Maquina: lavadora 1</label>
              <input
                type="checkbox"
                id="restart_lav1"
                name="restart_lav1"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_lav2">Re-inicio de Maquina: lavadora 2</label>
              <input
                type="checkbox"
                id="restart_lav2"
                name="restart_lav2"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_lav3">Re-inicio de Maquina: lavadora 3</label>
              <input
                type="checkbox"
                id="restart_lav3"
                name="restart_lav3"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_lav4">Re-inicio de Maquina: lavadora 4</label>
              <input
                type="checkbox"
                id="restart_lav4"
                name="restart_lav4"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_sec1">Re-inicio de Maquina: secadora 1</label>
              <input
                type="checkbox"
                id="restart_sec1"
                name="restart_sec1"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_sec2">Re-inicio de Maquina: secadora 2</label>
              <input
                type="checkbox"
                id="restart_sec2"
                name="restart_sec2"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="restart_sec3">Re-inicio de Maquina: secadora 3</label>
              <input
                type="checkbox"
                id="restart_sec3"
                name="restart_sec3"
                value="false" 
                unchecked />
            </div>
          </li>
        </ol>
      </div>


      <h3>Exterior</h3>
      <div>
        <ol>
          <li>
            <div class="action">
              <label for="clean_billetes">Limpieza de ranura billetes</label>
              <input
                type="checkbox"
                id="clean_billetes"
                name="clean_billetes"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="clean_tarjetas">Limpieza de ranura tarjetas</label>
              <input
                type="checkbox"
                id="clean_tarjetas"
                name="clean_tarjetas"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="clean_superficie">Limpieza de superficies</label>
              <input
                type="checkbox"
                id="clean_superficie"
                name="clean_superficie"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="filter_1">Limpieza Filtro: secadora 1</label>
              <input
                type="checkbox"
                id="filter_1"
                name="filter_1"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="filter_2">Limpieza Filtro: secadora 2</label>
              <input
                type="checkbox"
                id="filter_2"
                name="filter_2"
                value="false" 
                unchecked />
            </div>
          </li>
          <li>
            <div class="action">
              <label for="filter_3">Limpieza Filtro: secadora 3</label>
              <input
                type="checkbox"
                id="filter_3"
                name="filter_3"
                value="false" 
                unchecked />
            </div>
          </li>

          
        </ol>
      </div>
     
        <h4><label for="comments">Comentarios:</label></h4>
        <input type="text" id="comments" name="comments"><br>

                  <br/> 
            <button type="submit" 
                  class="btn btn-lg" 
                  style="margin-top:20px;">Submit</button>
      </form>

<script>
  /* validation for file type */
    function validateFile(file) {
      // Size check (e.g., 5MB limit)
          const maxSize = 9 * 1024 * 1024; // 5MB in bytes
          if (file.size > maxSize) {
              alert('File too large. Maximum size is 9MB');
              return false;
          }
          // Type check
          const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];
          if (!allowedTypes.includes(file.type)) {
              alert('Invalid file type. Please upload JPG, PNG or PDF');
              return false;
          }

          return true;
      }

   /* new file upload */
    function updateFileName(input) {
          const fileNameDisplay = document.getElementById('file-name-display');
          if (input.files.length > 0) {
              fileNameDisplay.textContent = input.files[0].name;
          } else {
              fileNameDisplay.textContent = 'No file chosen';
          }
      }

    function makeAjaxCall(data) {
        var URL = "https://6tadzueogh.execute-api.us-east-1.amazonaws.com/default-v0/contact";

        $.ajax({
            type: "POST",
            url: URL,
            dataType: "json",
            crossDomain: true,
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function(response) {
                console.log('Success:', response);
                if (response.error) {
                    alert("Error: " + response.message);
                } else {
                    alert("Successful");
                    document.getElementById("contact-form").reset();
                    document.getElementById('file-name-display').textContent = 'No file chosen';
                }
            },
            error: function(xhr, status, error) {
                console.log('Error details:', {
                    status: xhr.status,
                    response: xhr.responseText,
                    error: error
                });
                alert("Error: " + (xhr.responseJSON?.message || status));
            }
        });
    }

    function makeAjaxCall(data) {
        var URL = "https://6tadzueogh.execute-api.us-east-1.amazonaws.com/default-v0/contact";
        
        // Show loading overlay
        document.getElementById('loading-overlay').style.display = 'block';
        
        // Disable submit button
        document.querySelector('button[type="submit"]').disabled = true;

        $.ajax({
            type: "POST",
            url: URL,
            dataType: "json",
            crossDomain: true,
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function(response) {
                // Hide loading overlay
                document.getElementById('loading-overlay').style.display = 'none';
                // Re-enable submit button
                document.querySelector('button[type="submit"]').disabled = false;
                
                console.log('Success:', response);
                if (response.error) {
                    alert("Error: " + response.message);
                } else {
                    alert("Successful");
                    document.getElementById("contact-form").reset();
                    document.getElementById('file-name-display').textContent = 'No file chosen';
                }
            },
            error: function(xhr, status, error) {
                // Hide loading overlay
                document.getElementById('loading-overlay').style.display = 'none';
                // Re-enable submit button
                document.querySelector('button[type="submit"]').disabled = false;
                
                console.log('Error details:', {
                    status: xhr.status,
                    response: xhr.responseText,
                    error: error
                });
                alert("Error: " + (xhr.responseJSON?.message || status));
            }
        });
    }



    function submitToAPI(e) {
        e.preventDefault();
        console.log('Form submission started');

          var user = $('input[name="user"]:checked').val();
          var concepto_mcf = $("#concepto_mcf").val();
          var currency = $("#currency").val();
          var cuenta = $("#cuenta").val();
          var concepto_proveedor = $("#concepto_proveedor").val();
          var num_factura = $("#num_factura").val();
          var nif = $("#nif").val();
          var razon_social = $("#razon_social").val();
          var concepto_banco = $("#concepto_banco").val();
          var gasto = $("#gasto").val();
          var iva = $("#iva").val();
          var irpf = $("#irpf").val();
          var otro = $("#otro").val();
          var isfiscal = $("#isfiscal").is(':checked');

          var data = {
              user: user,
              concepto_mcf: concepto_mcf,
              currency: currency,
              cuenta: cuenta,
              concepto_proveedor: concepto_proveedor,
              num_factura: num_factura,
              nif: nif,
              razon_social: razon_social,
              gasto: parseFloat(gasto),
              iva: parseFloat(iva),
              irpf: parseFloat(irpf),
              otro: parseFloat(otro),
              isfiscal: isfiscal,
              concepto_banco: concepto_banco
          };

        // Get the file input
        var fileInput = document.getElementById('receipt-upload');
        var file = fileInput.files[0];

        // If a file is selected, read it and convert to base64
        if (file) {
          if (!validateFile(file)) {
                 return false;
          }
            console.log('Processing file:', file.name);
            var reader = new FileReader();
            reader.onload = function(e) {
                var base64Content = e.target.result.split(',')[1];
                
                // Add file information in the expected format
                data.file = {
                    content: base64Content,
                    name: file.name,
                    type: file.type
                };
                
                console.log('File processed, sending data');
                makeAjaxCall(data);
            };
            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                alert('Error reading file');
            };
            reader.readAsDataURL(file);
        } else {
            console.log('No file selected, sending data without file');
            makeAjaxCall(data);
        }
    }

</script>

<div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 5px; text-align: center;">
      <p>Processing your request...</p>
      <p>Please wait a moment</p>
  </div>
</div>

</body>
</html>